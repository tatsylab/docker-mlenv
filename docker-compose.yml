services:
  app:
    environment:
      - COMPOSE_PROJECT_NAME=${USERNAME:-user}
    build:
      context: .
      args:
        USER_ID: ${UID}
        GROUP_ID: ${GID}
        USERNAME: ${USERNAME:-user}

    image: mlenv-app:${USERNAME:-user}
    container_name: mlenv-app-${USERNAME:-user}
    user: ${USERNAME:-user}
    hostname: docker
    shm_size: 16gb
    command: tail -f /dev/null
    volumes:
      - type: bind
        source: /data
        target: /data
      - type: bind
        source: ./dev
        target: /home/${USERNAME:-user}/dev

    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

volumes:
  data:
  dev:
